---
layout: default
---

<script src="{{ '/assets/js/puzzle.js' | relative_url }}"></script>
<script>
  window.onpopstate = function popStateLoadPost() {
    let id;
    let href = document.URL;

    if(event.state) { id = event.state.id; }
    else            { id = document.URL; }
    loadPost(id, href);
  };

  function clickLoadPost() {
    let href = event.target.href;
    let id = event.target.id;
    let stateObj = { "id": id };

    event.preventDefault();
    loadPost(id, href);
    history.pushState(stateObj, href, href);
  }

  function loadPost(id, href) {
    callAjax(href, function displayPost(responseText) {
      let targetDiv = document.querySelector('.ajaxTarget');
      let bufferDiv = document.createElement('div');

      bufferDiv.innerHTML = responseText.trim();
      bufferDiv.childNodes.forEach(function (el) {
        if(
          el.nodeName != undefined &&
          el.nodeName != 'META' &&
          el.nodeName != 'LINK' &&
          el.nodeName != '#text'
        ) {
          let source = el.querySelector('.ajaxTarget');

          console.log("displaying", source);
          targetDiv.innerHTML = "";
          targetDiv.appendChild(source);
        }
      });
    });
  }

  function callAjax(url, callback){
    // Found at https://stackoverflow.com/a/18324384/11305897
    var xmlhttp;
    // compatible with IE7+, Firefox, Chrome, Opera, Safari
    xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function(){
      // The state will toggle on many times at each piece arriving.
      // readyState 4 is DONE.
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
        callback(xmlhttp.responseText);
      }
    }
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
  }
</script>

<link rel="stylesheet" href="{{ '/assets/css/puzzle.css' | relative_url }}" />
<link rel="stylesheet" href="{{ '/assets/css/fonts.css' | relative_url }}" />

<div id="ecran"></div>

<div id="banner">
  <div class="content">
    <a href="/">
      <h1 class="title">{{ site.title | escape }}</h1>
    </a>

    {{ site.description }}

  </div>
</div>

{%- if site.posts.size > 0 -%}
  <div id="nav">

    <!-- Post cloud -->

    <style>
      .nuage {
          width: 50%;
          height: 100%;
          background-repeat: no-repeat;
          background-size: contain;
          background-position: center;
      }
      .nuage.gauche {
          float: left;
          shape-outside: url(/images/nuage_gauche.svg);
          clip-path: url(/images/nuage_gauche.svg);
       }
      .nuage.droit {
          float: right;
          shape-outside: url(/images/nuage_droit.svg);
          clip-path: url(/images/nuage_droit.svg);
       }
    </style>

    <svg id="box-nuage" viewBox="0 0 720 360" preserveAspectRatio="none" >
      <path d="M0,0 H720 V360 H0 Z" fill="transparent" stroke="transparent" />
      <foreignObject x="0" y="0" width="720" height="360">
        <body xmlns="http://www.w3.org/1999/xhtml">
          <div id="mots">
            <span class="nuage gauche"></span>
            <span class="nuage droit"></span>
            {%- for post in site.posts -%}
              {% assign wc = post.content.size | divided_by: 100 %}
              {% assign postid = post.url | split: '/' | last | split: '.' | first %}
              <a    id="mot-{{ postid }}"
                    href="{{ post.url }}"
                    class="mot wordcount-{{ wc }}"
                    onclick="clickLoadPost()">{{ post.title | escape }}</a>
            {%- endfor -%}
          </div>
        </body>
      </foreignObject>
    </svg>
  </div>

  <main class="ajaxTarget">
    {{ content | markdownify }}
  </main>

{%- endif -%}

